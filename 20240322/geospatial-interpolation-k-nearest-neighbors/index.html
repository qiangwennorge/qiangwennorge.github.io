<!DOCTYPE HTML><html lang="en"><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script><head><meta charset="utf-8"><meta name="keywords" content="Geospatial interpolation - K-nearest neighbors, Wenvenn"><meta name="description" content="K-Nearest Neighbors (short as KNN) is a neighbor-based learning method that can be used for interpolation, in this case "><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><script async src="https://www.googletagmanager.com/gtag/js?id=G-VYP094MR3V"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-VYP094MR3V")</script><title>Geospatial interpolation - K-nearest neighbors | Wenvenn</title><link rel="icon" type="image/png" href="/favicon-32x32.png"><link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css"><link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><script src="/libs/jquery/jquery-3.6.0.min.js"></script><meta name="generator" content="Hexo 5.4.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="Wenvenn" type="application/atom+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="/android-chrome-192x192.png" class="logo-img" alt="LOGO"> <span class="logo-span">Wenvenn</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>Home</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fas fa-chart-bar" style="zoom:.6"></i> <span>Shortcuts</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:.6"></i> <span>Tags</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:.6"></i> <span>Categories</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:.6"></i> <span>Archives</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fas fa-address-card" style="zoom:.6"></i> <span>About</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:.6"></i> <span>About</span></a></li><li><a href="/friends"><i class="fas fa-link" style="margin-top:-20px;zoom:.6"></i> <span>Usefull Links</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/projects" class="waves-effect waves-light"><i class="fas fa-cogs" style="zoom:.6"></i> <span>Projects</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="Search" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/android-chrome-192x192.png" class="logo-img circle responsive-img"><div class="logo-name">Wenvenn</div><div class="logo-desc"></div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> Home</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-chart-bar"></i> Shortcuts <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>Tags</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>Categories</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>Archives</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-address-card"></i> About <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/about" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>About</span></a></li><li><a href="/friends" style="margin-left:75px"><i class="fa fas fa-link" style="position:absolute;left:50px"></i> <span>Usefull Links</span></a></li></ul></li><li class="m-nav-item"><a href="/projects" class="waves-effect waves-light"><i class="fa-fw fas fa-cogs"></i> Projects</a></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/9.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Geospatial interpolation - K-nearest neighbors</h1></div></div></div></div></div><main class="container content"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/sklearn/"><span class="chip bg-color">sklearn</span> </a><a href="/tags/geopandas/"><span class="chip bg-color">geopandas</span> </a><a href="/tags/shapely/"><span class="chip bg-color">shapely</span> </a><a href="/tags/geopy/"><span class="chip bg-color">geopy</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Machine-Learning/" class="post-category">Machine Learning</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp; 2024-03-22</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp; 2024-03-23</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp; 1.3k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp; 7 Min</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.css"><div class="card-content article-card-content"><div id="articleContent"><p>K-Nearest Neighbors (short as KNN) is a neighbor-based learning method that can be used for interpolation, in this case KNN looks for a specified number k of sampled points closests to an unknown point.</p><p>In this article, we have tried the following two applications by KNN algorithm:</p><ul><li>BallTree</li><li>KNN regressor</li></ul><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Ball_tree">BallTree</a> is a space partitioning data structure for organizing points in a multi-dimensional space. A most common application of ball tree is for nearest neighbor search, the algorithm exploits the distance property of the ball tree. With this method, the unknown point is interpolated by the k nearest neighbors’ value (in our case is the measurement of 5G signal), a weighted method based on the distance (inverse distance weighting) is used as closer points have larger weight when deciding the unknown point’s value.</p><p><a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KNeighborsRegressor.html">KNN regressor</a> can be achieved by using sklearn library, the target (the unknow point) is predicted by local interpolation of the targets associated of the nearest neighbors.</p><h2 id="Data-Preparation"><a href="#Data-Preparation" class="headerlink" title="Data Preparation"></a>Data Preparation</h2><p>The 5G measurement is done by a 5G capable phone which could record the 5G serving cell information and signal quality information during the drive test, including physical cell ID, frequency, received signal strength (RSRP, RSRQ and SINR) etc. This measurement is an evidence of the network coverage and quality, but normally it cannot cover the every corner, therefore data interpolation is needed.</p><p>Geopandas can also read KML file, therefore it is possible to use geopandas to process the selv-defined polygons from Google Earth, refer references from <a target="_blank" rel="noopener" href="https://geopandas.org/en/stable/docs/user_guide/io.html">Link 1</a> and <a target="_blank" rel="noopener" href="https://gis.stackexchange.com/questions/446036/reading-kml-with-geopandas">Link 2</a>.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> geopandas <span class="token keyword">as</span> gpd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> geopandas <span class="token keyword">import</span> GeoDataFrame
<span class="token keyword">from</span> shapely<span class="token punctuation">.</span>geometry <span class="token keyword">import</span> Point
<span class="token keyword">import</span> geopy<span class="token punctuation">.</span>distance
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> BallTree
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># load 5G measurements</span>
measurement_5g <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'5G Serving Cell.csv'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># create a GeoDataFrame with each measurement as a Point</span>
measurement_5g_gdf <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoDataFrame<span class="token punctuation">(</span>measurement_5g<span class="token punctuation">,</span> geometry<span class="token operator">=</span>gpd<span class="token punctuation">.</span>points_from_xy<span class="token punctuation">(</span>measurement_5g<span class="token punctuation">[</span><span class="token string">'Longitude'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> measurement_5g<span class="token punctuation">[</span><span class="token string">'Latitude'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> crs<span class="token operator">=</span><span class="token string">'EPSG:4326'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># import the polygon created from Google Earth</span>
gpd<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>fiona<span class="token punctuation">.</span>drvsupport<span class="token punctuation">.</span>supported_drivers<span class="token punctuation">[</span><span class="token string">'KML'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'rw'</span>
hyvinkaa <span class="token operator">=</span> gpd<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">'Hyvinkaa.kml'</span><span class="token punctuation">,</span> driver<span class="token operator">=</span><span class="token string">'KML'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">color_map</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> val <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">110</span><span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">"#FF333C"</span>
    <span class="token keyword">elif</span> val <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">"#FF6133"</span>
    <span class="token keyword">elif</span> val <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">"#FFFF33"</span>
    <span class="token keyword">elif</span> val <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">"#A2FF33"</span>
    <span class="token keyword">elif</span> val <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">"#228E03"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token string">"#0E3B01"</span>
    <span class="token keyword">return</span> color
measurement_5g_gdf<span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span> <span class="token operator">=</span> measurement_5g_gdf<span class="token punctuation">[</span><span class="token string">'RSRP(dBm)'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>color_map<span class="token punctuation">)</span>

<span class="token comment"># Create subplots</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Stylize plots</span>
plt<span class="token punctuation">.</span>style<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'bmh'</span><span class="token punctuation">)</span>

<span class="token comment"># Plot data</span>
hyvinkaa<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax <span class="token operator">=</span> ax<span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'bisque'</span><span class="token punctuation">,</span> edgecolor <span class="token operator">=</span> <span class="token string">'dimgray'</span><span class="token punctuation">)</span>
measurement_5g_gdf<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax <span class="token operator">=</span> ax<span class="token punctuation">,</span> marker <span class="token operator">=</span> <span class="token string">'o'</span><span class="token punctuation">,</span> color <span class="token operator">=</span> measurement_5g_gdf<span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> markersize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment"># Set title</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'5G Measurement in Hyvinkää Finland'</span><span class="token punctuation">,</span> fontdict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'fontsize'</span><span class="token punctuation">:</span> <span class="token string">'15'</span><span class="token punctuation">,</span> <span class="token string">'fontweight'</span> <span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>Text(0.5, 1.0, '5G Measurement in Hyvinkää Finland')
</code></pre><p><img src="https://media.publit.io/file/Geospatial-interpolation-K-Nearest-Neighbors-1.png" alt="5G Measurement in Hyvinkää Finland"></p><h2 id="Build-the-Grid"><a href="#Build-the-Grid" class="headerlink" title="Build the Grid"></a>Build the Grid</h2><p>To turn this data into a density map we will first need a grid. Then we can assign the 5G measurement value of the closest nearby property to each centroid.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># get extent of polygon's bounds</span>
min_x_poly<span class="token punctuation">,</span> min_y_poly<span class="token punctuation">,</span> max_x_poly<span class="token punctuation">,</span> max_y_poly <span class="token operator">=</span> hyvinkaa<span class="token punctuation">.</span>total_bounds

<span class="token comment"># create bounding box</span>
LB <span class="token operator">=</span> <span class="token punctuation">(</span>min_y_poly<span class="token punctuation">,</span>min_x_poly<span class="token punctuation">)</span>  <span class="token comment"># Left Bottom</span>
LT <span class="token operator">=</span> <span class="token punctuation">(</span>max_y_poly<span class="token punctuation">,</span>min_x_poly<span class="token punctuation">)</span>  <span class="token comment"># Left Top</span>
RB <span class="token operator">=</span> <span class="token punctuation">(</span>min_y_poly<span class="token punctuation">,</span>max_x_poly<span class="token punctuation">)</span>  <span class="token comment"># Right Bottom</span>
RT <span class="token operator">=</span> <span class="token punctuation">(</span>max_y_poly<span class="token punctuation">,</span>max_x_poly<span class="token punctuation">)</span>  <span class="token comment"># Right Top</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># calculate the longitude distance and latitude distance</span>
max_longitude_distance <span class="token operator">=</span> geopy<span class="token punctuation">.</span>distance<span class="token punctuation">.</span>distance<span class="token punctuation">(</span>LT<span class="token punctuation">,</span>RT<span class="token punctuation">)</span><span class="token punctuation">.</span>km 
max_latitude_distance<span class="token operator">=</span> geopy<span class="token punctuation">.</span>distance<span class="token punctuation">.</span>distance<span class="token punctuation">(</span>RB<span class="token punctuation">,</span>RT<span class="token punctuation">)</span><span class="token punctuation">.</span>km

<span class="token comment"># create the grid interval as 10 meters</span>
longitude_interval <span class="token operator">=</span> geopy<span class="token punctuation">.</span>distance<span class="token punctuation">.</span>distance<span class="token punctuation">(</span>kilometers<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>

<span class="token comment"># calculate how many grids are need along longitude and latitude domain</span>
grid<span class="token operator">=</span>longitude_interval<span class="token punctuation">.</span>km
n_longitude_grid_points <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>max_longitude_distance<span class="token punctuation">)</span><span class="token operator">/</span>grid<span class="token punctuation">)</span>
n_latitude_grid_points  <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>max_latitude_distance<span class="token punctuation">)</span><span class="token operator">/</span>grid<span class="token punctuation">)</span>
latitude_interval_degrees <span class="token operator">=</span> <span class="token punctuation">(</span>max_y_poly <span class="token operator">-</span> min_y_poly<span class="token punctuation">)</span><span class="token operator">/</span>n_latitude_grid_points<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># greate a list of points</span>
points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># build the grid</span>
<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_latitude_grid_points<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># Vertical </span>
    <span class="token comment"># start from bottom left (LB)</span>
    start <span class="token operator">=</span> <span class="token punctuation">(</span>min_y_poly<span class="token operator">+</span><span class="token punctuation">(</span>j<span class="token operator">*</span>latitude_interval_degrees<span class="token punctuation">)</span><span class="token punctuation">,</span>min_x_poly<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_longitude_grid_points<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># Horizontal</span>
        <span class="token comment"># Calculate the next point in the longitude direction </span>
        lon_offset <span class="token operator">=</span> longitude_interval<span class="token punctuation">.</span>destination<span class="token punctuation">(</span>start<span class="token punctuation">,</span> bearing<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">.</span> \
                      longitude <span class="token operator">-</span> start<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        next_point <span class="token operator">=</span> <span class="token punctuation">(</span>start<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> start<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> lon_offset<span class="token punctuation">)</span>        
        points<span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_point<span class="token punctuation">)</span>        
        start <span class="token operator">=</span> next_point

<span class="token comment"># Make a GeoDataFrame which will hold the grid</span>
points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> point <span class="token keyword">in</span> points<span class="token punctuation">]</span>
points_gdf <span class="token operator">=</span> <span class="token punctuation">[</span>Point<span class="token punctuation">(</span>point<span class="token punctuation">)</span> <span class="token keyword">for</span> point <span class="token keyword">in</span> points<span class="token punctuation">]</span> 
grid <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoDataFrame<span class="token punctuation">(</span>geometry<span class="token operator">=</span>points_gdf<span class="token punctuation">,</span> crs<span class="token operator">=</span><span class="token string">'epsg:4326'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Create subplots</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Stylize plots</span>
plt<span class="token punctuation">.</span>style<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'bmh'</span><span class="token punctuation">)</span>

<span class="token comment"># Plot data</span>
hyvinkaa<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax <span class="token operator">=</span> ax<span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'bisque'</span><span class="token punctuation">,</span> edgecolor <span class="token operator">=</span> <span class="token string">'dimgray'</span><span class="token punctuation">)</span>
grid<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax <span class="token operator">=</span> ax<span class="token punctuation">,</span> marker <span class="token operator">=</span> <span class="token string">'o'</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'limegreen'</span><span class="token punctuation">,</span> markersize <span class="token operator">=</span> <span class="token number">0.005</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>&lt;Axes: &gt;
</code></pre><p><img src="https://media.publit.io/file/Geospatial-interpolation-K-Nearest-Neighbors-2.png" alt="Grid map"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Perform a spatial join between the two GeoDataFrames</span>
joined <span class="token operator">=</span> gpd<span class="token punctuation">.</span>sjoin<span class="token punctuation">(</span>grid<span class="token punctuation">,</span> hyvinkaa<span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'inner'</span><span class="token punctuation">)</span>

<span class="token comment"># Keep only the points inside the multipolygon</span>
points_within_regions <span class="token operator">=</span> joined<span class="token punctuation">[</span><span class="token string">'geometry'</span><span class="token punctuation">]</span>

<span class="token comment"># Create a new GeoDataFrame with only the points inside the multipolygon</span>
grid_within_regions <span class="token operator">=</span> gpd<span class="token punctuation">.</span>GeoDataFrame<span class="token punctuation">(</span>geometry<span class="token operator">=</span>points_within_regions<span class="token punctuation">,</span> crs<span class="token operator">=</span><span class="token string">'epsg:4326'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Create subplots</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> figsize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Stylize plots</span>
plt<span class="token punctuation">.</span>style<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'bmh'</span><span class="token punctuation">)</span>

<span class="token comment"># Plot data</span>
hyvinkaa<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax <span class="token operator">=</span> ax<span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'bisque'</span><span class="token punctuation">,</span> edgecolor <span class="token operator">=</span> <span class="token string">'dimgray'</span><span class="token punctuation">)</span>
grid_within_regions<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax <span class="token operator">=</span> ax<span class="token punctuation">,</span> marker <span class="token operator">=</span> <span class="token string">'o'</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'limegreen'</span><span class="token punctuation">,</span> markersize <span class="token operator">=</span> <span class="token number">0.005</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>&lt;Axes: &gt;
</code></pre><p><img src="https://media.publit.io/file/Geospatial-interpolation-K-Nearest-Neighbors-3.png" alt="Grid map in the polygon"></p><h2 id="K-Nearest-Neighbors-BallTree"><a href="#K-Nearest-Neighbors-BallTree" class="headerlink" title="K-Nearest Neighbors: BallTree"></a>K-Nearest Neighbors: BallTree</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Create a BallTree</span>
tree <span class="token operator">=</span> BallTree<span class="token punctuation">(</span>measurement_5g_gdf<span class="token punctuation">[</span><span class="token string">'geometry'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> p<span class="token punctuation">:</span> <span class="token punctuation">[</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>leaf_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># Query the BallTree on each centroid in 'grid_within_regions'</span>
<span class="token comment"># to find the distance and id of 1 nearest neighbour in the 5G measurement</span>
num_neighbors <span class="token operator">=</span> <span class="token number">3</span> <span class="token comment"># The number of nearest neighbors</span>
distances<span class="token punctuation">,</span> indices <span class="token operator">=</span> tree<span class="token punctuation">.</span>query<span class="token punctuation">(</span>
    grid_within_regions<span class="token punctuation">[</span><span class="token string">'geometry'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> p<span class="token punctuation">:</span> <span class="token punctuation">[</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    k<span class="token operator">=</span>num_neighbors<span class="token punctuation">)</span>

measurement_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>measurement_5g_gdf<span class="token punctuation">[</span><span class="token string">'RSRP(dBm)'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token keyword">for</span> idx <span class="token keyword">in</span> row<span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> indices<span class="token punctuation">]</span><span class="token punctuation">)</span> 
<span class="token comment"># Calculate the inverse of the distances</span>
inverse_distances <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> distances

<span class="token comment"># Calculate the sum of the weights </span>
row_sum <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>inverse_distances<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Normalize each row </span>
normalized_weights <span class="token operator">=</span> inverse_distances<span class="token operator">/</span> row_sum

<span class="token comment"># Multiply the measurements by the corresponding weights</span>
weighted_measurement <span class="token operator">=</span> normalized_weights <span class="token operator">*</span> measurement_array

<span class="token comment"># The measurement will be the sum of their weighted values</span>
idw_measurement <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>weighted_measurement<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Assign the measurement to the grid</span>
grid_within_regions<span class="token punctuation">[</span><span class="token string">'5G RSRP(dBm)'</span><span class="token punctuation">]</span><span class="token operator">=</span> idw_measurement<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Visualize-the-Results"><a href="#Visualize-the-Results" class="headerlink" title="Visualize the Results"></a>Visualize the Results</h3><p>The 5G coverage prediction in the center area could be more trustworthy as we have more measurement samples there, while on the boarder area, due to unsufficient number of samples, the prediction doesn’t look good.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Plot the results</span>

<span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>colors <span class="token keyword">import</span> LinearSegmentedColormap
<span class="token keyword">import</span> contextily <span class="token keyword">as</span> ctx

color_palette<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">215</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">238</span><span class="token punctuation">,</span><span class="token number">248</span><span class="token punctuation">,</span><span class="token number">185</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token number">185</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
color_palette<span class="token operator">=</span>color_palette<span class="token operator">/</span><span class="token number">255</span>

cmap <span class="token operator">=</span> LinearSegmentedColormap<span class="token punctuation">.</span>from_list<span class="token punctuation">(</span><span class="token string">'5G RSRP(dBm)'</span><span class="token punctuation">,</span> color_palette<span class="token punctuation">)</span> 

grid_within_regions <span class="token operator">=</span> grid_within_regions<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> grid_within_regions<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">'5G RSRP(dBm)'</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>cmap<span class="token operator">=</span>cmap<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
ctx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'DNA 5G Coverage in Hyvinkää Finland using KNN BallTree'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://media.publit.io/file/Geospatial-interpolation-K-Nearest-Neighbors-4.png" alt="DNA 5G Coverage in Hyvinkää Finland using KNN BallTree"></p><h2 id="K-Nearest-Neighbor-Regressor"><a href="#K-Nearest-Neighbor-Regressor" class="headerlink" title="K-Nearest Neighbor Regressor"></a>K-Nearest Neighbor Regressor</h2><p>Using KDTree as the neighbor search algorithm, available choices are: ‘auto’, ‘ball_tree’, ‘kd_tree’, ‘brute’</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>neighbors <span class="token keyword">import</span> KNeighborsRegressor

<span class="token comment"># Get X and Y coordinates of measurement points and grid centroids</span>
grid_within_regions <span class="token operator">=</span> grid_within_regions<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">4326</span><span class="token punctuation">)</span>
x_meas <span class="token operator">=</span> measurement_5g_gdf<span class="token punctuation">[</span><span class="token string">"geometry"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x
y_meas <span class="token operator">=</span> measurement_5g_gdf<span class="token punctuation">[</span><span class="token string">"geometry"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y
x_grid <span class="token operator">=</span> grid_within_regions<span class="token punctuation">[</span><span class="token string">'geometry'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x
y_grid <span class="token operator">=</span> grid_within_regions<span class="token punctuation">[</span><span class="token string">'geometry'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y

<span class="token comment"># Create list of XY coordinate pairs</span>
coords_meas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>xy<span class="token punctuation">)</span> <span class="token keyword">for</span> xy <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>x_meas<span class="token punctuation">,</span> y_meas<span class="token punctuation">)</span><span class="token punctuation">]</span>
coords_grid <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>xy<span class="token punctuation">)</span> <span class="token keyword">for</span> xy <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>x_grid<span class="token punctuation">,</span> y_grid<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># Create a KNeighborsRegressor instance with the desired number of neighbors</span>
knn_regressor <span class="token operator">=</span> KNeighborsRegressor<span class="token punctuation">(</span>n_neighbors<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">'kd_tree'</span><span class="token punctuation">,</span> weights<span class="token operator">=</span><span class="token string">'distance'</span><span class="token punctuation">)</span>

<span class="token comment"># Fit the KNeighborsRegressor to the input points and weights</span>
knn_regressor<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>coords<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>measurement_5g_gdf<span class="token punctuation">[</span><span class="token string">'RSRP(dBm)'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Perform KNN interpolation</span>
interpolated_weights <span class="token operator">=</span> knn_regressor<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>coords_grid<span class="token punctuation">)</span> 

<span class="token comment"># assign the results to the grid</span>
grid_within_regions<span class="token punctuation">[</span><span class="token string">'KNN 5G RSRP(dBm)'</span><span class="token punctuation">]</span> <span class="token operator">=</span> interpolated_weights<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Visualize-the-Results-1"><a href="#Visualize-the-Results-1" class="headerlink" title="Visualize the Results"></a>Visualize the Results</h3><p>Similar as BallTree approach, more measurements are required for better prediction.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Plot the results</span>

grid_within_regions <span class="token operator">=</span> grid_within_regions<span class="token punctuation">.</span>to_crs<span class="token punctuation">(</span>epsg<span class="token operator">=</span><span class="token number">3857</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> grid_within_regions<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>column<span class="token operator">=</span><span class="token string">'KNN 5G RSRP(dBm)'</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>cmap<span class="token operator">=</span>cmap<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
ctx<span class="token punctuation">.</span>add_basemap<span class="token punctuation">(</span>ax<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'DNA 5G Coverage in Hyvinkää Finland using KNN Regressor'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://media.publit.io/file/Geospatial-interpolation-K-Nearest-Neighbors-5.png" alt="DNA 5G Coverage in Hyvinkää Finland using KNN Regressor"></p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a target="_blank" rel="noopener" href="https://medium.com/@francode77/interpolation-using-knn-and-idw-fe546d5fb9ae">https://medium.com/@francode77/interpolation-using-knn-and-idw-fe546d5fb9ae</a></p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">Author: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">wenvenn</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">Link: </i></span><span class="reprint-info"><a href="https://www.wenvenn.com/20240322/geospatial-interpolation-k-nearest-neighbors/">https://www.wenvenn.com/20240322/geospatial-interpolation-k-nearest-neighbors/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">Reprint policy: </i></span><span class="reprint-info">All articles in this blog are used except for special statements <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> reprint policy. If reproduced, please indicate source <a href="/about" target="_blank">wenvenn</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/sklearn/"><span class="chip bg-color">sklearn</span> </a><a href="/tags/geopandas/"><span class="chip bg-color">geopandas</span> </a><a href="/tags/shapely/"><span class="chip bg-color">shapely</span> </a><a href="/tags/geopy/"><span class="chip bg-color">geopy</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;Previous</div><div class="card"><a href="/20240326/customizing-plot-legends/"><div class="card-image"><img src="/medias/featureimages/15.jpg" class="responsive-img" alt="Customizing plot legends"> <span class="card-title">Customizing plot legends</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-03-26 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Data-Visualization/" class="post-category">Data Visualization</a></span></div></div><div class="card-action article-tags"><a href="/tags/numpy/"><span class="chip bg-color">numpy</span> </a><a href="/tags/matplotlib/"><span class="chip bg-color">matplotlib</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">Next&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/20240316/geospatial-interpolation-thiessen-polygons/"><div class="card-image"><img src="/medias/featureimages/12.jpg" class="responsive-img" alt="Geospatial interpolation - Thiessen Polygons"> <span class="card-title">Geospatial interpolation - Thiessen Polygons</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-03-16 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Machine-Learning/" class="post-category">Machine Learning</a></span></div></div><div class="card-action article-tags"><a href="/tags/geopandas/"><span class="chip bg-color">geopandas</span> </a><a href="/tags/contextily/"><span class="chip bg-color">contextily</span> </a><a href="/tags/pyproj/"><span class="chip bg-color">pyproj</span> </a><a href="/tags/shapely/"><span class="chip bg-color">shapely</span></a></div></div></div></div></article></div><script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2021-2024</span> <a href="/about" target="_blank">Wenvenn</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;Total Words:&nbsp;<span class="white-color">33.5k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp; <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp; <span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t="2021",n=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),r=e.getHours(),o=e.getMinutes(),s=e.getSeconds(),e=Date.UTC(t,"12","6","22","0","0"),i=Date.UTC(n,a,i,r,o,s)-e,r=Math.floor(i/31536e6),o=Math.floor(i/864e5-365*r),s=Math.floor(i/36e5-365*r*24-24*o),e=Math.floor(i/6e4-365*r*24*60-24*o*60-60*s);Math.floor(i/1e3-365*r*24*60*60-24*o*60*60-60*s*60-60*e);t===String(n)?(document.getElementById("year").innerHTML=n,e="This site has been running for "+o+" days",document.getElementById("sitetime").innerHTML=e):(document.getElementById("year").innerHTML=t+" - "+n,o="This site has been running for "+r+" years and "+o+" days",document.getElementById("sitetime").innerHTML=o)};calcSiteTime()</script><br><div class="github-badge"><a style="color:#fff" rel="license" href="https://github.com/" target="_blank" title="静态网页托管于 GitHub Pages"><span class="badge-subject">Hosted</span> <span class="badge-value bg-brightgreen">GitHub</span></a></div><div class="github-badge"><a style="color:#fff" rel="license" href="https://www.cloudflare.com/" target="_blank" title="Cloudflare提供域名相关服务"><span class="badge-subject">DNS</span> <span class="badge-value bg-blueviolet">Cloudflare</span></a></div><div class="github-badge"><a style="color:#fff" rel="license" href="https://publit.io/" target="_blank" title="Publitio提供图片存储"><span class="badge-subject">Image</span> <span class="badge-value bg-red">Publitio</span></a></div><div class="github-badge"><a style="color:#fff" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="本站点采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可"><span class="badge-subject"><i class="fa fa-copyright"></i></span> <span class="badge-value bg-lightgrey">CC BY 4.0</span></a></div><style>.github-badge{display:inline-block;border-radius:4px;text-shadow:none;font-size:13px;color:#fff;line-height:15px;background-color:#abbac3;margin-bottom:5px}.github-badge .badge-subject{display:inline-block;background-color:#4d4d4d;padding:4px 4px 4px 6px;border-top-left-radius:4px;border-bottom-left-radius:4px}.github-badge .badge-value{display:inline-block;padding:4px 6px 4px 4px;border-top-right-radius:4px;border-bottom-right-radius:4px}.github-badge .bg-brightgreen{background-color:#4dc820!important}.github-badge .bg-orange{background-color:orange!important}.github-badge .bg-yellow{background-color:#d8b024!important}.github-badge .bg-blueviolet{background-color:#8833d7!important}.github-badge .bg-pink{background-color:#f26bae!important}.github-badge .bg-red{background-color:#e05d44!important}.github-badge .bg-blue{background-color:#007ec6!important}.github-badge .bg-lightgrey{background-color:#9f9f9f!important}.github-badge .bg-gray,.github-badge .bg-grey{background-color:#555!important}.github-badge .bg-lightgray,.github-badge .bg-lightgrey{background-color:#9f9f9f!important}</style></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/qiangwennorge" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i> </a><a href="mailto:qiang.wen.norge@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span> <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){!function(t,r,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),t=document.getElementById(r),n=document.getElementById(s);t.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var n,e,r,s=!0,i=t.title.trim().toLowerCase(),l=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),a=0===(a=t.url).indexOf("/")?t.url:"/"+a,c=-1,u=-1;""!==i&&""!==l&&h.forEach(function(t,e){n=i.indexOf(t),c=l.indexOf(t),n<0&&c<0?s=!1:(c<0&&(c=0),0===e&&(u=c))}),s&&(o+="<li><a href='"+a+"' class='search-result-title'>"+i+"</a>",e=t.content.trim().replace(/<[^>]+>/g,""),0<=u&&(a=u+80,(a=0===(t=(t=u-20)<0?0:t)?100:a)>e.length&&(a=e.length),r=e.substr(t,a),h.forEach(function(t){var e=new RegExp(t,"gi");r=r.replace(e,'<em class="search-keyword">'+t+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})}("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script type="text/javascript">var windowWidth=$(window).width();768<windowWidth&&document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>')</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?96c14430edaa02f468fca771961be30b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script type="text/javascript" color="0,0,255" pointcolor="104,33,122" opacity="0.7" zindex="-1" count="99" src="/libs/background/canvas-nest.js"></script><script type="text/javascript" size="150" alpha="0.6" zindex="-1" src="/libs/background/ribbon.min.js" async></script><script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script type="text/javascript">var st,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="Wenvenn",clearTimeout(st)):(document.title="Welcome Back!",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script></body></html>