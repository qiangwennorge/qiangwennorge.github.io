<!DOCTYPE HTML><html lang="en"><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script><head><meta charset="utf-8"><meta name="keywords" content="Risk-adjusted performance metrics calculation in Python, Wenvenn"><meta name="description" content="Sharpe RatioIt is virtually impossible to increase return without also increasing risk, therefore it shall exist a trade"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer-when-downgrade"><script async src="https://www.googletagmanager.com/gtag/js?id=G-VYP094MR3V"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-VYP094MR3V")</script><title>Risk-adjusted performance metrics calculation in Python | Wenvenn</title><link rel="icon" type="image/png" href="/favicon-32x32.png"><link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css"><link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><script src="/libs/jquery/jquery-3.6.0.min.js"></script><meta name="generator" content="Hexo 5.4.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="Wenvenn" type="application/atom+xml"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="/android-chrome-192x192.png" class="logo-img" alt="LOGO"> <span class="logo-span">Wenvenn</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>Home</span></a></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fas fa-chart-bar" style="zoom:.6"></i> <span>Shortcuts</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:.6"></i> <span>Tags</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:.6"></i> <span>Categories</span></a></li><li><a href="/archives"><i class="fas fa-archive" style="margin-top:-20px;zoom:.6"></i> <span>Archives</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="" class="waves-effect waves-light"><i class="fas fa-address-card" style="zoom:.6"></i> <span>About</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/about"><i class="fas fa-user-circle" style="margin-top:-20px;zoom:.6"></i> <span>About</span></a></li><li><a href="/friends"><i class="fas fa-link" style="margin-top:-20px;zoom:.6"></i> <span>Usefull Links</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/projects" class="waves-effect waves-light"><i class="fas fa-cogs" style="zoom:.6"></i> <span>Projects</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="Search" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/android-chrome-192x192.png" class="logo-img circle responsive-img"><div class="logo-name">Wenvenn</div><div class="logo-desc"></div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> Home</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-chart-bar"></i> Shortcuts <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px"><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>Tags</span></a></li><li><a href="/categories" style="margin-left:75px"><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>Categories</span></a></li><li><a href="/archives" style="margin-left:75px"><i class="fa fas fa-archive" style="position:absolute;left:50px"></i> <span>Archives</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-address-card"></i> About <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/about" style="margin-left:75px"><i class="fa fas fa-user-circle" style="position:absolute;left:50px"></i> <span>About</span></a></li><li><a href="/friends" style="margin-left:75px"><i class="fa fas fa-link" style="position:absolute;left:50px"></i> <span>Usefull Links</span></a></li></ul></li><li class="m-nav-item"><a href="/projects" class="waves-effect waves-light"><i class="fa-fw fas fa-cogs"></i> Projects</a></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/15.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Risk-adjusted performance metrics calculation in Python</h1></div></div></div></div></div><main class="container content"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/numpy/"><span class="chip bg-color">numpy</span> </a><a href="/tags/pandas/"><span class="chip bg-color">pandas</span> </a><a href="/tags/yfinance/"><span class="chip bg-color">yfinance</span> </a><a href="/tags/matplotlib/"><span class="chip bg-color">matplotlib</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Quantitative-Investment/" class="post-category">Quantitative Investment</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp; 2024-03-06</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp; 2024-03-23</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp; 1.1k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp; 7 Min</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><link rel="stylesheet" href="/libs/prism/prism.css"><div class="card-content article-card-content"><div id="articleContent"><h2 id="Sharpe-Ratio"><a href="#Sharpe-Ratio" class="headerlink" title="Sharpe Ratio"></a>Sharpe Ratio</h2><p>It is virtually impossible to increase return without also increasing risk, therefore it shall exist a trade-off between risk and return which encourages us to find a metric so that by using it we can maximize the return while minimize the risk.</p><p>The Sharpe Ratio, developed by Nobel Prize winner William Sharpe, helps investors evaluate the return of an investment compared to its risk relative to a risk-free asset. It has three key metrics: the annual return of the investment, the prevailing risk-free rate, and the standard deviation of the investment’s returns.</p><p>Shape Ratio = (r_portfolio - r_rf) / std_portfolio</p><p>Where:</p><ul><li>r_portfolio is annual return of the portfolio</li><li>r_rf is the risk-free rate - usually the rate offered by short-term Treasury bills.</li><li>std_portfolio is the standard deviation of the portfolio’s return.</li></ul><p>Now is the moment to estimate the Sharpe Ratio for S&amp;P 500 (<strong>^GSPC</strong>) by using Python.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> yfinance <span class="token keyword">as</span> yf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">sp500 <span class="token operator">=</span> yf<span class="token punctuation">.</span>Ticker<span class="token punctuation">(</span><span class="token string">'^GSPC'</span><span class="token punctuation">)</span>
data_sp500 <span class="token operator">=</span> sp500<span class="token punctuation">.</span>history<span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token string">'1d'</span><span class="token punctuation">,</span> start<span class="token operator">=</span><span class="token string">'2023-03-06'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'2024-03-06'</span><span class="token punctuation">)</span>
data_sp500<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}</style><p></p><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Open</th><th>High</th><th>Low</th><th>Close</th><th>Volume</th><th>Dividends</th><th>Stock Splits</th></tr><tr><th>Date</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2023-03-06 00:00:00-05:00</th><td>4055.149902</td><td>4078.489990</td><td>4044.610107</td><td>4048.419922</td><td>4000870000</td><td>0.0</td><td>0.0</td></tr><tr><th>2023-03-07 00:00:00-05:00</th><td>4048.260010</td><td>4050.000000</td><td>3980.310059</td><td>3986.370117</td><td>3922500000</td><td>0.0</td><td>0.0</td></tr><tr><th>2023-03-08 00:00:00-05:00</th><td>3987.550049</td><td>4000.409912</td><td>3969.760010</td><td>3992.010010</td><td>3535570000</td><td>0.0</td><td>0.0</td></tr><tr><th>2023-03-09 00:00:00-05:00</th><td>3998.659912</td><td>4017.810059</td><td>3908.699951</td><td>3918.320068</td><td>4445260000</td><td>0.0</td><td>0.0</td></tr><tr><th>2023-03-10 00:00:00-05:00</th><td>3912.770020</td><td>3934.050049</td><td>3846.320068</td><td>3861.590088</td><td>5518190000</td><td>0.0</td><td>0.0</td></tr></tbody></table></div><pre class="line-numbers language-python" data-language="python"><code class="language-python">sp500_close <span class="token operator">=</span> data_sp500<span class="token punctuation">[</span><span class="token string">'Close'</span><span class="token punctuation">]</span>
<span class="token comment"># Daily return is estimated as the log difference from the closing price</span>
sp500_dr <span class="token operator">=</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>sp500_close<span class="token punctuation">)</span><span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Consdier 260 weekdays in a 52-week year, but generally markets are closed for about 8 days each year for holidays, therefore to calculate the yearly mean return we could use the average daily return to multiply 252.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">sp500_meanreturn <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>sp500_dr<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">251</span>
sp500_volatility <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>sp500_dr<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">251</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Calculate the Sharpe Ratio of S&amp;P500</span>
<span class="token comment"># risk-free rate is using short-term Threasury yields ~5% (https://www.bloomberg.com/markets/rates-bonds/government-bonds/us)</span>
rfr <span class="token operator">=</span> <span class="token number">0.05</span>
sp500_sharpe_ratio <span class="token operator">=</span> <span class="token punctuation">(</span>sp500_meanreturn <span class="token operator">-</span> rfr<span class="token punctuation">)</span><span class="token operator">/</span>sp500_volatility 
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The estimated Sharpe Ratio for S&amp;P 500 is: '</span><span class="token punctuation">,</span> sp500_sharpe_ratio<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>The estimated Sharpe Ratio for S&amp;P 500 is:  1.4460114773564745
</code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'S&amp;P 500 total return is: '</span><span class="token punctuation">,</span> sp500_close<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span>sp500_close<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'S&amp;P 500 volatility is: '</span><span class="token punctuation">,</span> sp500_volatility<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre><code>S&amp;P 500 total return is:  0.254477055332641
S&amp;P 500 volatility is:  0.1222111992429432
</code></pre><p>The above result implies that to achieve 25.45% - 5% = 20.45% yearly return, the volatility would be 12.22%, this also informs that:</p><ul><li>Maximum gain: Volatility + Excess Return = 12.22% + 20.45% = 32.67%</li><li>Maximum loss: -Volatility + Excess Return = -12.22% + 20.45% = 8.23%</li></ul><p>In this case, in a year range, the excess return could be range between 8.23% to 32.67%</p><h2 id="Sortino-Ratio"><a href="#Sortino-Ratio" class="headerlink" title="Sortino Ratio"></a>Sortino Ratio</h2><p>When calculating Sharpe Ratio, the standard deviation is used as the volatility, while it does not differentiate upward deviations from downward deviations, and in fact we actually seek upward deviations.</p><p>The Sortino Ratio is very similar to the Sharpe Ratio, the only difference being that where the Sharpe Ratio uses all the observations for calculating the standard deviation while the Sortino Ratio only considers the downward deviations.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sortino_ratio</span><span class="token punctuation">(</span>series<span class="token punctuation">,</span> td<span class="token punctuation">,</span> rfr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mean <span class="token operator">=</span> series<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> td <span class="token operator">-</span> rfr
    std_neg <span class="token operator">=</span> series<span class="token punctuation">[</span>series<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>td<span class="token punctuation">)</span>
    <span class="token keyword">return</span> mean<span class="token operator">/</span>std_neg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">sp500_sortino_ratio <span class="token operator">=</span> sortino_ratio<span class="token punctuation">(</span>sp500_dr<span class="token punctuation">,</span> <span class="token number">252</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The estimated Sortino Ratio for S&amp;P 500 is: '</span><span class="token punctuation">,</span> sp500_sortino_ratio<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre><code>The estimated Sortino Ratio for S&amp;P 500 is:  2.318163296302093
</code></pre><h2 id="Calmar-Ratio"><a href="#Calmar-Ratio" class="headerlink" title="Calmar Ratio"></a>Calmar Ratio</h2><p>Before talking about the Carmar Ratio, we need to understand the Max Drawdown, which quantifies the steepest decline from peak to trough observed for an investment.</p><p>Max Drawdown is useful as it doesn’t rely on the underlying returns being normally distributed (which is not realistic in the markets).</p><p>The Max Drawdown should be interpreted as: numbers closer to zero are preferable.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">max_drawdown</span><span class="token punctuation">(</span>series<span class="token punctuation">)</span><span class="token punctuation">:</span>
    compound_return <span class="token operator">=</span> series<span class="token punctuation">.</span>cumprod<span class="token punctuation">(</span><span class="token punctuation">)</span>
    peak <span class="token operator">=</span> compound_return<span class="token punctuation">.</span>expanding<span class="token punctuation">(</span>min_periods<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    drawdown <span class="token operator">=</span> compound_return<span class="token operator">/</span>peak <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">return</span> drawdown<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">sp500_max_drawdown <span class="token operator">=</span> max_drawdown<span class="token punctuation">(</span>sp500_dr<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The estimated Max Drawdown for S&amp;P 500 is: '</span><span class="token punctuation">,</span> sp500_max_drawdown<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre><code>The estimated Max Drawdown for S&amp;P 500 is:  -1.0145839694360674
</code></pre><p>The Carmar Ratio is then calculated as the average return divided by the Max Drawdown.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">carmar_ratio</span><span class="token punctuation">(</span>series<span class="token punctuation">,</span> td<span class="token punctuation">)</span><span class="token punctuation">:</span>
    max_dd <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>max_drawdown<span class="token punctuation">(</span>series<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> series<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> td <span class="token operator">/</span> max_dd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">sp500_carmar_ratio <span class="token operator">=</span> carmar_ratio<span class="token punctuation">(</span>sp500_dr<span class="token punctuation">,</span> <span class="token number">252</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The estimated Carmar Ratio for S&amp;P 500 is: '</span><span class="token punctuation">,</span> sp500_carmar_ratio<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre><code>The estimated Carmar Ratio for S&amp;P 500 is:  0.22435014327283942
</code></pre><h2 id="Omega-Ratio"><a href="#Omega-Ratio" class="headerlink" title="Omega Ratio"></a>Omega Ratio</h2><p>The Sharpe Ratio and Sortino Ratio works well if the return is in normal distribution, while this is not realistic in the markets. The Sharpe Ratio could hide some important information about the patterns of the returns, for example two different return distributions could have the same mean and standard deviation, but differ significantly in other aspects.</p><p>Omega Ratio is the probability-weighted ratio of gains over losses at a given level of expected return (known as threshold). It does this by adding up the area under the distribution around the threshold, the area above the threshold measures the weight of the gains, while the area below the threshold measures the weight of the losses. The Omega Ratio is the positive area divided by the negative area.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">omega_ratio</span><span class="token punctuation">(</span>series<span class="token punctuation">,</span> td<span class="token punctuation">,</span> threshold<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># calculate daily threshold</span>
    dailyThreshold <span class="token operator">=</span> <span class="token punctuation">(</span>threshold<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>td<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment"># calculate the excess return</span>
    excess_return <span class="token operator">=</span> series <span class="token operator">-</span> dailyThreshold
    <span class="token comment"># get sum of all values excess return above 0</span>
    positiveSum <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>excess_return<span class="token punctuation">[</span>excess_return <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># get sum of all values excess return below 0</span>
    negativeSum <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>excess_return<span class="token punctuation">[</span>excess_return <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> positiveSum<span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">-</span>negativeSum<span class="token punctuation">)</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">sp500_dr<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>bins<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre><code>&lt;Axes: &gt;
</code></pre><p><img src="https://media.publit.io/file/Risk-Adjusted-Performance-Metrics-Calculation-in-Python-1.png" alt="S&amp;P500 Daily Return"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">sp500_omega_ratio <span class="token operator">=</span> omega_ratio<span class="token punctuation">(</span>sp500_dr<span class="token punctuation">,</span> <span class="token number">252</span><span class="token punctuation">,</span> <span class="token number">0.005</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The estimated Omega Ratio with threshold 0.5% for S&amp;P 500 is: '</span><span class="token punctuation">,</span> sp500_omega_ratio<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre><code>The estimated Omega Ratio with threshold 0.5% for S&amp;P 500 is:  1.2180141953898103
</code></pre><p>It has better view to plot the Omega Ratio curve with changing thresholds.</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
omega_ratios <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
thresholds <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> thresholds<span class="token punctuation">:</span>
    val <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span>omega_ratio<span class="token punctuation">(</span>sp500_dr<span class="token punctuation">,</span> <span class="token number">252</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    omega_ratios<span class="token punctuation">.</span>append<span class="token punctuation">(</span>val<span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>thresholds<span class="token punctuation">,</span> omega_ratios<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Omega Ratio"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Threshold"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>Text(0.5, 0, 'Threshold')
</code></pre><p><img src="https://media.publit.io/file/Risk-Adjusted-Performance-Metrics-Calculation-in-Python-2.png" alt="Omega Ratio"></p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">Author: </i></span><span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">wenvenn</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">Link: </i></span><span class="reprint-info"><a href="https://www.wenvenn.com/20240306/risk-adjusted-performance-metrics-calculation-in-python/">https://www.wenvenn.com/20240306/risk-adjusted-performance-metrics-calculation-in-python/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">Reprint policy: </i></span><span class="reprint-info">All articles in this blog are used except for special statements <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> reprint policy. If reproduced, please indicate source <a href="/about" target="_blank">wenvenn</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/numpy/"><span class="chip bg-color">numpy</span> </a><a href="/tags/pandas/"><span class="chip bg-color">pandas</span> </a><a href="/tags/yfinance/"><span class="chip bg-color">yfinance</span> </a><a href="/tags/matplotlib/"><span class="chip bg-color">matplotlib</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i>&nbsp;Previous</div><div class="card"><a href="/20240310/nearest-neighbor-in-geospatial-data-analysis/"><div class="card-image"><img src="/medias/featureimages/20.jpg" class="responsive-img" alt="Nearest neighbor in geospatial data analysis"> <span class="card-title">Nearest neighbor in geospatial data analysis</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-03-10 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Data-Analysis/" class="post-category">Data Analysis</a></span></div></div><div class="card-action article-tags"><a href="/tags/geopandas/"><span class="chip bg-color">geopandas</span> </a><a href="/tags/shapely/"><span class="chip bg-color">shapely</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">Next&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/20240301/calculate-capital-asset-pricing-model-capm-with-python/"><div class="card-image"><img src="/medias/featureimages/17.jpg" class="responsive-img" alt="Calculate Capital Asset Pricing Model (CAPM) with Python"> <span class="card-title">Calculate Capital Asset Pricing Model (CAPM) with Python</span></div></a><div class="card-content article-content"><div class="summary block-with-text"></div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2024-03-01 </span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/Quantitative-Investment/" class="post-category">Quantitative Investment</a></span></div></div><div class="card-action article-tags"><a href="/tags/yfinance/"><span class="chip bg-color">yfinance</span> </a><a href="/tags/plotly/"><span class="chip bg-color">plotly</span></a></div></div></div></div></article></div><script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2021-2024</span> <a href="/about" target="_blank">Wenvenn</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;Total Words:&nbsp;<span class="white-color">42.4k</span> <span id="busuanzi_container_site_pv">&nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp; <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv">&nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp; <span id="busuanzi_value_site_uv" class="white-color"></span></span><br><span id="sitetime">Loading ...</span><script>var calcSiteTime=function(){var e=new Date,t="2021",n=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),r=e.getHours(),o=e.getMinutes(),s=e.getSeconds(),e=Date.UTC(t,"12","6","22","0","0"),i=Date.UTC(n,a,i,r,o,s)-e,r=Math.floor(i/31536e6),o=Math.floor(i/864e5-365*r),s=Math.floor(i/36e5-365*r*24-24*o),e=Math.floor(i/6e4-365*r*24*60-24*o*60-60*s);Math.floor(i/1e3-365*r*24*60*60-24*o*60*60-60*s*60-60*e);t===String(n)?(document.getElementById("year").innerHTML=n,e="This site has been running for "+o+" days",document.getElementById("sitetime").innerHTML=e):(document.getElementById("year").innerHTML=t+" - "+n,o="This site has been running for "+r+" years and "+o+" days",document.getElementById("sitetime").innerHTML=o)};calcSiteTime()</script><br><div class="github-badge"><a style="color:#fff" rel="license" href="https://github.com/" target="_blank" title="静态网页托管于 GitHub Pages"><span class="badge-subject">Hosted</span> <span class="badge-value bg-brightgreen">GitHub</span></a></div><div class="github-badge"><a style="color:#fff" rel="license" href="https://www.cloudflare.com/" target="_blank" title="Cloudflare提供域名相关服务"><span class="badge-subject">DNS</span> <span class="badge-value bg-blueviolet">Cloudflare</span></a></div><div class="github-badge"><a style="color:#fff" rel="license" href="https://publit.io/" target="_blank" title="Publitio提供图片存储"><span class="badge-subject">Image</span> <span class="badge-value bg-red">Publitio</span></a></div><div class="github-badge"><a style="color:#fff" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="本站点采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可"><span class="badge-subject"><i class="fa fa-copyright"></i></span> <span class="badge-value bg-lightgrey">CC BY 4.0</span></a></div><style>.github-badge{display:inline-block;border-radius:4px;text-shadow:none;font-size:13px;color:#fff;line-height:15px;background-color:#abbac3;margin-bottom:5px}.github-badge .badge-subject{display:inline-block;background-color:#4d4d4d;padding:4px 4px 4px 6px;border-top-left-radius:4px;border-bottom-left-radius:4px}.github-badge .badge-value{display:inline-block;padding:4px 6px 4px 4px;border-top-right-radius:4px;border-bottom-right-radius:4px}.github-badge .bg-brightgreen{background-color:#4dc820!important}.github-badge .bg-orange{background-color:orange!important}.github-badge .bg-yellow{background-color:#d8b024!important}.github-badge .bg-blueviolet{background-color:#8833d7!important}.github-badge .bg-pink{background-color:#f26bae!important}.github-badge .bg-red{background-color:#e05d44!important}.github-badge .bg-blue{background-color:#007ec6!important}.github-badge .bg-lightgrey{background-color:#9f9f9f!important}.github-badge .bg-gray,.github-badge .bg-grey{background-color:#555!important}.github-badge .bg-lightgray,.github-badge .bg-lightgrey{background-color:#9f9f9f!important}</style></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/qiangwennorge" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i> </a><a href="mailto:qiang.wen.norge@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span> <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword" class="search-input"></div><div id="searchResult"></div></div></div><script type="text/javascript">$(function(){!function(t,r,s){"use strict";$.ajax({url:t,dataType:"xml",success:function(t){var e=$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),t=document.getElementById(r),n=document.getElementById(s);t.addEventListener("input",function(){var o='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(e.forEach(function(t){var n,e,r,s=!0,i=t.title.trim().toLowerCase(),l=t.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),a=0===(a=t.url).indexOf("/")?t.url:"/"+a,c=-1,u=-1;""!==i&&""!==l&&h.forEach(function(t,e){n=i.indexOf(t),c=l.indexOf(t),n<0&&c<0?s=!1:(c<0&&(c=0),0===e&&(u=c))}),s&&(o+="<li><a href='"+a+"' class='search-result-title'>"+i+"</a>",e=t.content.trim().replace(/<[^>]+>/g,""),0<=u&&(a=u+80,(a=0===(t=(t=u-20)<0?0:t)?100:a)>e.length&&(a=e.length),r=e.substr(t,a),h.forEach(function(t){var e=new RegExp(t,"gi");r=r.replace(e,'<em class="search-keyword">'+t+"</em>")}),o+='<p class="search-result">'+r+"...</p>"),o+="</li>")}),o+="</ul>",n.innerHTML=o)})}})}("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script type="text/javascript">var windowWidth=$(window).width();768<windowWidth&&document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>')</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?96c14430edaa02f468fca771961be30b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script type="text/javascript" color="0,0,255" pointcolor="104,33,122" opacity="0.7" zindex="-1" count="99" src="/libs/background/canvas-nest.js"></script><script type="text/javascript" size="150" alpha="0.6" zindex="-1" src="/libs/background/ribbon.min.js" async></script><script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script type="text/javascript">var st,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="Wenvenn",clearTimeout(st)):(document.title="Welcome Back!",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script></body></html>